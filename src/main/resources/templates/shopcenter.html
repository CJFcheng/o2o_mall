<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>商家管理中心</title>
    <link rel="stylesheet" type="text/css" href="/bootst/css/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="/bootst/css/bootstrap-switch.min.css"/>
    <script src="/bootst/js/jquery-3.4.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/bootst/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="/bootst/js/bootstrap-switch.min.js"></script>
    <script src="/laydate/laydate.js"></script>
</head>

<body>
<div class="container">

    <!--上导航栏-->
    <nav class="nav navbar navbar-fixed-top navbar-default"  style=" border-bottom:2px solid #aa131c;padding-bottom: 0;padding-top: 0;margin-bottom: 0">
        <div class="col-xs-1">
            <a href="/index">
                <h3 class="text-left"><span class="glyphicon glyphicon-menu-left "></span></h3></a>
        </div>
        <div class="col-xs-10">
            <h3 class="text-center"><strong>商家中心</strong></h3>
        </div>
        <div class="col-xs-1">
        </div>

    </nav>
    <!--空盒子，避免内容被导航栏遮到-->
    <div style="height: 70px;"></div>
    <!--底部导航栏-->
    <nav class="nav navbar navbar-fixed-bottom navbar-default"  style=" border-top:2px solid #aa131c; ">

        <a href="#leibie" class="btn  "id="bleig" data-toggle="tab" style="display: none" ></a>

            <!--隐藏分类管理-->
        <a href="#dingdan" class="btn col-xs-4 " data-toggle="tab" >
            <h5>订单管理</h5></a>
        <div class=" btn dropup col-xs-4 ">
            <a href="#" class="   dropdown-toggle" id="Menu2" data-toggle="dropdown">
                <h5>商品管理</h5>
            </a>
            <ul  class="dropdown-menu" aria-labelledby="Menu2">
                <li ><a  class="btn "  onclick="F5lei()">
                    <h6 >分类管理</h6></a></li>
                <li role="separator" class="divider" style="padding: 0px;margin: 0px;"></li>
                <li><a href="/add" class="btn"><h6>快速添加商品</h6></a></li>
                <li role="separator" class="divider" style="padding: 0px;margin: 0px;"></li>
                <li><a href="/cmdtlist/fou" class="btn "><h6>待上架商品</h6></a></li>
                <li role="separator" class="divider" style="padding: 0px;margin: 0px;"></li>
                <li><a href="/cmdtlist/shi" class="btn"><h6>已上架商品</h6></a></li>
            </ul>
        </div>
        <a href="#geren" class="btn col-xs-4" data-toggle="tab">
            <h5>个人中心</h5></a>
    </nav>
    <div class="tab-content">
        <!--按钮对应盒子-->
        <!--订单管理-->
        <div id="dingdan" class="tab-pane  ">
            <div class="container row" id="ttdd" >
            <a class="btn btn-default col-xs-12" style="margin-top: 20px" th:each=" DD :${dingdan}">
                <div class="col-xs-12" style="margin-left: 0;padding-left: 0">
                    <div class="col-xs-4" style="margin-left: 0;padding-left: 0">
                          <h6>订单编号：<strong th:text="'000000'+${DD.id}">000</strong></h6>
                    </div>
                    <div class="col-xs-8">
                    </div>
                </div>
                <div  class="col-xs-12" style="margin: 0;padding: 0">
                    <hr style="border:none;border-top:1px solid #bdbdbd;margin: 0;padding: 0;margin-bottom: 10px"  />
                </div>
                <div class="col-xs-12 img-rounded" style="background-color: #e4e3ef; margin-left: 0;padding-left: 0;padding-right: 0;margin-right: 0">
                    <div class="col-xs-4" style="margin-left: 0;padding-left: 0">
                        <img src="/imge/下载.jpg" class="img-rounded" th:src="'/image/' + ${DD.sppicture}"  style="height: 100px;width: 100px;">
                    </div>
                    <div class="col-xs-8" style=";text-align: left">
                        <h4 style="margin-bottom: 0;padding-bottom: 0"><p th:text="${DD.spname}" style=" overflow: hidden;white-space: nowrap; text-overflow: ellipsis ;width: 100% ;font-size:110%;" >猪杂汤粉+鸡蛋</p></h4>
                        <div class="col-xs-12" style="margin: 0;padding: 0;">
                            <div class="col-xs-6" style="margin: 0;padding: 0"><h6>￥<strong  style="color: red" th:text="${DD.danjia}">12</strong> </h6></div>
                            <div class="col-xs-6" style="margin: 0;padding: 0"><h6 style="text-align: right" th:text="${DD.amount}">x7</h6></div>
                        </div>
                        <div class="col-xs-12" style="text-align: right;margin: 0;padding: 0;"><h5>总金额：<strong style="color: red" th:text="${DD.total}">234</strong></h5></div>
                    </div>
                </div>
                <div  class="col-xs-12"style="margin: 0;padding: 0">
                    <hr style="border:none;border-top:1px solid #bdbdbd;margin: 0;padding: 0;margin-top: 10px"  />
                </div>

                <div class="col-xs-12" style="text-align: left;margin-left: 0;padding-left: 0;">

                    <h6>客户姓名：<strong th:text="${DD.name}">程俊锋</strong></h6>
                    <h6>联系电话：<strong th:text="${DD.phone}">18312449021</strong></h6>
                    <h6>地址：<strong th:text="${DD.address}">广东海洋大学寸金学院厚德1055</strong></h6>
                </div>
                <div class="col-xs-12" style="text-align: right;margin: 0;padding: 0">
                    <p class="btn btn-primary" th:onclick="TokDD([[${DD.id}]]);">确认订单</p>
                </div>

            </a>

            </div>
        </div>
        <!--调整类别-->
        <div id="leibie" class="tab-pane ">
            <h5><strong>调整店内类别</strong></h5>

            <table id="leibieol" class=" table table-hover table-striped">
                <tr class="" th:each="setlei:${lei}">
                    <td>
                        <h4 th:text="${setleiStat.count}"></h4>
                    </td>
                    <td>

                        <div class="col-xs-5 input-group pull-left">
                            <input type="text" class=" form-control " th:value="${setlei}"
                                   aria-describedby="basic-addon1" th:id="showlei+${setleiStat.index}">
                            <span class=" btn input-group-addon  glyphicon glyphicon-refresh " id="basic-addon1"
                                  th:if="${setlei}!='默认分类'" th:onclick="upthis([[${setleiStat.index}]]);"></span>
                        </div>
                        <div class=" col-xs-7 ">
                            <button class="btn btn-success col-xs-4" th:if="${setleiStat.index}!=0"
                                    th:onclick="putup([[${setleiStat.index}]]);">上移
                            </button>
                            <div class=" btn btn-success col-xs-4 " disabled="disabled" th:if="${setleiStat.index}==0">
                                上移
                            </div>

                            <button class="btn btn-success col-xs-4" th:if="!${setleiStat.last}"
                                    th:onclick="putdown([[${setleiStat.index}]]);">下移
                            </button>
                            <div class=" btn  btn-success col-xs-4" disabled="disabled" th:if="${setleiStat.last}">下移
                            </div>

                            <button class="btn btn-danger col-xs-4" th:if="${setlei}!='默认分类'"
                                    th:onclick="deletelei([[${setleiStat.index}]]);">删除
                            </button>
                            <div class="btn btn-danger col-xs-4 " disabled="disabled" th:if="${setlei}=='默认分类'">删除</div>
                        </div>
                    </td>

                </tr>


            </table>


            <br/>

            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary btn-sm col-xs-12" data-toggle="modal" data-target="#addnew">
                <h5>新建分类</h5>
            </button>

            <!--  新建分类 -->
            <div class="modal fade" id="addnew" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">

                            <h4 class="modal-title" id="myModalLabel">新建分类</h4>
                        </div>
                        <div class="modal-body">

                            <input type="text" class="form-control" id="lei" maxlength="10" placeholder="限制长度10">
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" id="addnewlei">确认
                            </button>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <!--商家个人中心-->
        <div id="geren" class="tab-pane active">
            <!--个人中心标头-->
            <div class="col-xs-12" style="background-color: #b8d2e1;padding: 10px">

                <div class="col-xs-4"style="margin: 0;padding: 0">
                    <img src="/imge/下载.jpg"  th:src="'/image/' + ${pic}" class="img-circle" style="height: 80px;width: 80px;">
                </div>
                <div class="col-xs-8" >
                <h4 style="text-align: left"><strong th:text="${lists.shopname}"></strong></h4>
                <br>
                <p style="text-align: right" >掌柜你好呀！</p>
                </div>
            </div>
            <br/><br/><br/><br/><br/><br/>
            <!--个人中心列表-->
            <ul class="nav list-group">
                <li >
                    <a href="/vip" class=""style="padding-top: 0;margin-top: 0">
                        <h4>认证资料<span class="glyphicon glyphicon-chevron-right "></span></h4></a>
                </li>
                <li>
                    <a href="#" style="padding-top: 0;margin-top: 0">
                        <h4 data-toggle="modal" data-target="#yytime">营业时间</h4></a>
                </li>
                <li>
                    <a href="#" class="" style="padding-top: 0;margin-top: 0">
                        <h4>营业状态&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <input class="switch " style="margin:0;padding: 0; margin-right: 5px;" name="status" type="checkbox" checked>
                        </h4></a>

                </li>
                <li>
                    <a href="#" style="padding-top: 0;margin-top: 0">
                        <h4 data-toggle="modal" data-target="#gonggao">小店公告</h4></a>
                </li>
                <li>
                    <a href="#"style="padding-top: 0;margin-top: 0">
                        <h4 data-toggle="modal" data-target="#huodong">活动发布</h4></a>
                </li>
                <li>
                    <a href="#" style="padding-top: 0;margin-top: 0">
                        <h4 data-toggle="modal" data-target="#repassword">修改密码</h4></a>
                </li>
                <li>
                    <a href="#" style="padding-top: 0;margin-top: 0">
                        <h4 data-toggle="modal" data-target="#help1">反馈中心</h4></a>
                </li>
                <li>
                    <a href="/outlogin" style="padding-top: 0;margin-top: 0" class="btn alert-success col-xs-12" >退出账号</a>
                </li>
            </ul>
            <!--公告发布框-->
            <div id="gonggao" class="modal fade bs-example-modal-lg " tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">更新公告</h4>
                        </div>
                        <div class="modal-body">
                            <textarea id="ggvue" name="ggvue" class="form-control" rows="3" maxlength="30"
                                      placeholder="最多输入30个字" th:text="${lists.shop_post}"></textarea>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="gongao();">更新
                            </button>
                        </div>
                        <br/>
                    </div>
                </div>
            </div>
            <!--活动发布表单-->
            <div id="huodong" class="modal fade bs-example-modal-lg" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">活动信息</h4>
                        </div>
                        <div id="bodyform" class="modal-body">
                            <h5>内容：</h5>
                            <textarea id="hdvue" name="hdvue" class="form-control" rows="3" maxlength="30"
                                      placeholder="最多输入30个字" th:text="${activity[0]}"></textarea>
                            <div class="form-group">
                                <h5>开始日期：</h5>
                                <input type="text" class="form-control" name="htime1" id="htime1"
                                       placeholder="yyyy年MM月dd日" maxlength="11" th:value="${activity[1]}">
                                <input type="text" class="form-control" name="htime2" id="htime2" placeholder="H点M分"
                                       maxlengthx="6" th:value="${activity[2]}">
                            </div>
                            <div class="form-group">
                                <h5>截止日期：</h5>
                                <input type="text" class="form-control" name="htime3" id="htime3"
                                       placeholder="yyyy年MM月dd日" maxlength="11" th:value="${activity[3]}">
                                <input type="text" class="form-control" name="htime4" id="htime4" placeholder="H点M分"
                                       maxlength="6" th:value="${activity[4]}">
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="activity();">
                                更新
                            </button>
                        </div>
                        <br/>
                    </div>
                </div>
            </div>
            <!--营业时间-->
            <div id="yytime" class="modal fade bs-example-modal-lg " tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div id="timeform" class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">设置营业时间</h4>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="btime">开店</label>
                                <input type="text" class="form-control testime" name="btime" id="btime"
                                       placeholder="设置每天定时开店" maxlength="8" th:value="${lists.opentime}">
                            </div>
                            <div class="form-group">
                                <label for="etime">关店</label>
                                <input type="text" class="form-control testime " name="etime" id="etime"
                                       placeholder="设置每天定时关店" maxlength="8" th:value="${lists.downtime}">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="ytime();">确认
                            </button>
                        </div>
                        <br/>
                    </div>
                </div>
            </div>
            <!--反馈中心-->
            <div id="help1" class="modal fade bs-example-modal-lg" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">反馈中心</h4>
                        </div>
                        <div class="modal-body">
                            <p>&nbsp;&nbsp;感谢您本产品支持，如有问题请联系客服QQ：1348203452</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" data-dismiss="modal">确认</button>
                        </div>
                        <br/>
                    </div>
                </div>
            </div>
            <!--修改密码-->
            <div id="repassword" class="modal fade bs-example-modal-lg" tabindex="-1">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title">修改密码</h4>
                        </div>
                        <div class="modal-body">

                            <div class="form-group">
                                <label for="oldpassword" class="col-sm-2 control-label">旧密码：</label>
                                <div class="col-sm-10">
                                    <input type="password" class="form-control" id="oldpassword" placeholder="请输入旧密码">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="new1" class="col-sm-2 control-label">新密码：</label>
                                <div class="col-sm-10">
                                    <input type="password" class="form-control" id="new1" placeholder="请输入新密码">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="new2" class="col-sm-2 control-label">新密码：</label>
                                <div class="col-sm-10">
                                    <input type="password" class="form-control" id="new2" placeholder="请再次输入新密码">
                                </div>
                            </div>

                            <p style="color: red" id="psa1"></p>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                                <button type="button" class="btn btn-primary"  onclick="repass();">确认</button>
                            </div>
                            <br/>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

</div>


<!--空盒子，避免内容被导航栏遮到-->
<div style="height:50px;"></div>
<!--事件函数-->

<script type="text/javascript" th:inline="javascript">
    //添加分类
    $("#addnewlei").click(function () {
        if ($("#lei").val() != null) {
            $.ajax({
                type: "POST",
                url: "/addlei",
                data: {
                    "addnewlei": $("#lei").val(),
                },
                error: function () {
                    alert("链接服务器失败");
                },
                success: function (date) {
                    if (date == "ok") {
                        $("#leibieol").load(location.href + " #leibieol");

                    } else {
                        alert("身份认证已过期，请重新登录");
                        window.location.href = '/login';
                    }

                }
            })
        }
    })

    //删除分类
    function deletelei(str) {
        $.ajax({
            type: "POST",
            url: "/deletelei",
            data: {
                "idlei": str,
            },

            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    $("#leibieol").load(location.href + " #leibieol");

                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }
            }
        })

    }

    //模仿点击
    function F5lei() {
        if(document.all) {

            document.getElementById("bleig").click();

        }

        // 其它浏览器

        else {

            var e = document.createEvent("MouseEvents");

            e.initEvent("click", true, true);

            document.getElementById("bleig").dispatchEvent(e);

        }

    }
    function upthis(str) {
        var textlei = "showlei" + str;
        //alert(textlei);


        $.ajax({
            type: "POST",
            url: "/uplei",
            data: {
                "idlei": str,
                "uptext": $("#" + textlei).val(),
            },

            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    $("#leibieol").load(location.href + " #leibieol");

                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }
            }
        })
    }

    //确认订单
    function TokDD(id) {
        $.ajax({
            type: "POST",
            url: "/TokDD",
            data: {
                "id": id,

            },

            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    $("#ttdd").load(location.href + " #ttdd");

                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }
            }
        })

    }

    //上移分类
    function putup(str) {
        $.ajax({
            type: "POST",
            url: "/upsx",
            data: {
                "maxid": str,
                "minid": str - 1,
            },

            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    $("#leibieol").load(location.href + " #leibieol");

                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }
            }
        })
    }

    //下移分类
    function putdown(str) {
        $.ajax({
            type: "POST",
            url: "/upsx",
            data: {
                "maxid": str + 1,
                "minid": str,
            },

            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    $("#leibieol").load(location.href + " #leibieol");

                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }

            }
        })
    }

    //更新公告
    gongao = function () {
        $.ajax({
            type: "POST",
            url: "/upgonggao",
            data: {
                "gonggao": $("#ggvue").val(),
            },
            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    $("#ggvue").load(location.href + " #ggvue");
                    alert("更新成功");
                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }

            }
        })
    }
    //更新活动刷新本页
    activity = function () {
        $.ajax({
            type: "POST",
            url: "/upactivity",
            data: {
                "thetext": $("#hdvue").val(),
                "betime1": $("#htime1").val(),
                "betime2": $("#htime2").val(),
                "entime1": $("#htime3").val(),
                "entime2": $("#htime4").val(),
            },
            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    window.location.reload();

                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }
            }
        })
    }
    //更新开店时间刷新本页
    ytime = function () {

        $.ajax({
            type: "POST",
            url: "/uptime",
            data: {
                "betime": $("#btime").val(),
                "entime": $("#etime").val(),
            },
            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    window.location.reload();

                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }
            }
        })

    }

    //更新状态
    upsp_status = function (str) {

        $.ajax({
            type: "POST",
            url: "/upsp_status",
            data: {
                "spstatus": str,

            },
            error: function () {
                alert("链接服务器失败");
            },
            success: function (date) {
                if (date == "ok") {
                    window.location.reload();

                } else if (data == "error") {
                    alert("更新失败");
                    window.location.reload();
                } else {
                    alert("身份认证已过期，请重新登录");
                    window.location.href = '/login';
                }
            }
        })


    }


    $('[name="status"]').bootstrapSwitch({    //初始化按钮
        onText: "营业中",
        offText: "关闭",
        onColor: "success",
        offColor: "default",// 设置OFF文本颜色        (info/success/warning/danger/primary)
        size: "small",// 设置控件大小,从小到大  (mini/small/normal/large)
        animate: "true",//动画效果
        onSwitchChange: function (event, state) {
            if (state == true) {//从关闭状态转化成营业启动下面事件
                //console.log("开启");
                // $('[name="status"]').bootstrapSwitch('state',true,true);
                upsp_status("开启");

            } else {
                //从营业转化成关闭激活事件
                //console.log("关闭");
                //$('[name="status"]').bootstrapSwitch('state',false,true);
                upsp_status("关闭");
            }
        }
    });


    if ([[${lists.sp_status}]] == "开启")
        $('[name="status"]').bootstrapSwitch('state', true, true);
    else if ([[${lists.sp_status}]] == "关闭") {
        $('[name="status"]').bootstrapSwitch('state', false, true);

    }


    function repass() {
        var old = $("#oldpassword").val();
        var new1 = $("#new1").val();
        var new2 = $("#new1").val();
        if (new1 == "" || new2 == "" || old == "" || new1 != new2) {
            $("#psa1").html("旧密码不能为空，或两次新密码不相等")
        } else {
            $.ajax({
                type: "POST",
                url: "/repassword",
                data: {
                    "old": old,
                    "new1": new1,
                },

                error: function () {
                    alert("链接服务器失败");
                },
                success: function (date) {
                    if (date == "ok") {
                        $("#psa1").html("修改成功")

                    } else if (date == "not")
                        $("#psa1").html("旧密码错误")
                    else {
                        alert("身份认证已过期，请重新登录");
                        window.location.href = '/login2';
                    }
                }
            })


        }
    }


</script>


</body>
<!--/营业时间选择器-->
<script>
    //营业时间选择器
    lay('.testime').each(function () {
        laydate.render({
            elem: this
            , trigger: 'click'
            , type: 'time'

        });
    });
    //活动开始时间选择器
    laydate.render({
        elem: '#htime1'
        , format: 'yyyy年MM月dd日'
    });

    laydate.render({
        elem: '#htime2'
        , type: 'time'
        , format: 'H点M分'
    });
    //活动截止时间选择器
    laydate.render({
        elem: '#htime3'
        , format: 'yyyy年MM月dd日'
    });

    laydate.render({
        elem: '#htime4'
        , type: 'time'
        , format: 'H点M分'
    });

</script>

</html>